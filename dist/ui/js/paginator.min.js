"use strict";define(function(require,exports,module){function e(e,t){return e>=t&&(e=t),1>e&&(e=1),e}var t=require("Widget"),a=require("./common/handlerbars"),i=a.compile(['<nav class="clearfix">','<ul class="pagination" style="float:left;">','<li class="JS-click-prev page-prev {{#isEqual nowTarget 1}}disabled{{/isEqual}}" data-label="prev"><a href="javascript:;" aria-label="Previous"><span aria-hidden="true" class="kuma-icon kuma-icon-triangle-left">«</span></a></li>',"{{#each list}}",'<li class="JS-click-active {{#isEqual this ../nowTarget}}active{{/isEqual}} {{#isEqual this "..."}}other{{/isEqual}}" data-now-target="{{this}}"><a href="javascript:;">{{this}}</li>',"{{/each}}",'<li class="JS-click-next page-next {{#isEqual nowTarget totle}}disabled{{/isEqual}}" data-label="next"><a href="javascript:;" aria-label="Next"><span aria-hidden="true" class="kuma-icon kuma-icon-triangle-right">»</span></a></li>',"</ul>","{{#if showCount}}",'<div style="float:left;margin-left:10px;margin-top:20px;" class="form-group-sm">共 {{count}} 条 </div>',"{{/if}}","{{#if showSizeList}}",'<div style="float:left;margin-left:10px;margin-top:20px;" class="form-group-sm">','<select class="JS-select-size page-size">',"{{#each sizeList}}","<option value={{value}} {{#if selected}}selected{{/if}}>{{value}}条/页</option>","{{/each}}","</select>","</div>","{{/if}}","{{#if showJump}}",'<div style="float:left;margin-left:10px;margin-top:20px;" class="form-group-sm">','<span class="fn-FS12">跳到<input type="text" class="form-control JS-target-page" style="display:inline-block;width:50px;" />页</span>',"</div>","{{/if}}","</nav>"].join("")),s=t.extend({className:"Paginator",attrs:{nowTarget:1,className:"paginator",showJump:!0,showCount:!1,side:1,totle:100,sizeList:[{value:10,selected:!0},{value:20},{value:30}],size:{value:10,getter:function(e){var t=this,a=e,i=t.$(".JS-select-size");return a=i.length?i.val():s.getSize(a,t.get("sizeList"))}}},events:{"click .JS-click-prev":"paginatorPrevNext","click .JS-click-next":"paginatorPrevNext","click .JS-click-active":function(e){var t=this,a=$(e.target).closest(".JS-click-active"),i=a.data("nowTarget");a.hasClass("active")||a.hasClass("other")||t.paginatorJump(i,e)},"change .JS-select-size":function(e){var t=this,a=e.target,i=a.value,s=t.get("sizeList");s=$.map(s,function(e,t){return delete e.selected,e.value==i&&(e.selected=!0),e}),t.paginatorJump(0,e)},pageJump:function(e){var t=this,a=t.$(".JS-target-page").val(),i=~~a;a&&t.paginatorJump(i,e)}},initProps:function(){var e=this;e.paginatorRenderData()},setup:function(){var e=this;e.paginatorRender(),e.paginatorEventJump()},propsInAttrs:["afterRender"],afterRender:function(){console.log("rendered")},paginatorRenderData:function(){var t,a,i,s=this,r=s.get("totle"),n=s.get("sizeList"),l=s.get("nowTarget"),o=s.get("side"),g=1,c=$.isArray(n)&&n.length,p=s.get("size");if(t=s.paginatorData={showCount:s.get("showCount"),showJump:s.get("showJump"),showSizeList:c,sizeList:s.get("sizeList")},t.count=r,a=s.paginatorMax=t.totle=Math.ceil(r/p),t.nowTarget=e(l,a),i=t.list=[],2*o+2>=a)for(;a>=g;g++)i.push(g);else{i.push(1),l>o+2&&i.push("...");var u=l-o>1?l-o:2,h=a>l+o?l+o:a-1;for(o+1>=l&&(h=2*o+1),l>=a-o&&(u=a-2*o),g=u;h>=g;g++)i.push(g);a-o-1>l&&i.push("..."),i.push(a)}return s},paginatorRender:function(){var e=this;return e.element.html(i(e.paginatorData)),e.trigger("after:render"),e},paginatorPrevNext:function(e){e.stopPropagation();var t=this;if(e&&e.target){var a=$(e.target).closest("[data-label]"),i=a.data("label"),s=t.get("nowTarget"),r="prev"===i?--s:++s;a.hasClass("disabled")||t.paginatorJump(r,e)}else t.log("缺少事件对象。")},paginatorJump:function(t,a){var i=this;return t=e(t,i.paginatorMax),(t!=i.get("nowTarget")||$(a.target).hasClass("JS-select-size"))&&(i.set("nowTarget",t),i.paginatorRenderData().paginatorRender(),i.trigger("change",t,a)),i},paginatorEventJump:function(){var e=this,t=e.element;e.get("showJump")&&(e.delegateEvents(document,"click.paginator",function(e){$(e.target).hasClass("JS-target-page")||t.trigger("pageJump",e)}),e.delegateEvents(document,"keyup.paginator",function(e){13==e.keyCode&&t.trigger("pageJump",e)}))},paginatorReload:function(e){var t=this;return t.resetConfig(e),t.paginatorRenderData().paginatorRender(),t},destroy:function(){var e=this;e.element.html(""),s.superclass.destroy.call(this)},Statics:{getSize:function(e,t){var a=e;if($.isArray(t)&&t.length){var i=t.filter(function(e){return e.selected});a=i.length?i[0].value:t[0].value}return a}}});return s});