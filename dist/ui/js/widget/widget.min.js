"use strict";define(function(require,exports,module){function e(){return"widget-"+_++}function t(e){return"[object String]"===E.call(e)}function n(e){return"[object Function]"===E.call(e)}function i(e){return y(document.documentElement,e)}function s(e){return e.charAt(0).toUpperCase()+e.substring(1)}function r(e){return n(e.events)&&(e.events=e.events()),e.events}function l(e,t){var n=e.match(A),i=n[1]+m+t.cid,s=n[2]||void 0;return s&&s.indexOf("{{")>-1&&(s=o(s,t)),{type:i,selector:s}}function o(e,n){return e.replace(R,function(e,i){for(var s,r=i.split("."),l=n;s=r.shift();)l=l===n.attrs?n.get(s):l[s];return t(l)?l:w})}function a(e){return null==e||void 0===e}function u(e){for(var t=e.length-1;t>=0&&void 0===e[t];t--)e.pop();return e}var $=require("jquery"),h=require("./base"),d=require("./daparser"),c=require("./auto-render"),m=".delegate-events-",f="_onRender",p="data-widget-cid",v={},g=h.extend({propsInAttrs:["initElement","element","events"],element:null,events:null,attrs:{id:null,className:null,style:null,template:"<div></div>",model:null,parentNode:document.body},initialize:function(t){this.cid=e();var n=this._parseDataAttrsConfig(t);g.superclass.initialize.call(this,t?$.extend(n,t):n),this.parseElement(),this.initProps(),this.delegateEvents(),this.setup(),this._stamp(),this._isTemplate=!(t&&t.element)},_parseDataAttrsConfig:function(e){var t,n;return e&&(t=$(e.initElement?e.initElement:e.element)),t&&t[0]&&!c.isDataApiOff(t)&&(n=d.parseElement(t)),n},parseElement:function(){var e=this.element;if(e?this.element=$(e):this.get("template")&&this.parseElementFromTemplate(),!this.element||!this.element[0])throw new Error("element is invalid")},parseElementFromTemplate:function(){this.element=$(this.get("template"))},initProps:function(){},delegateEvents:function(e,i,s){var o=u(Array.prototype.slice.call(arguments));if(0===o.length?(i=r(this),e=this.element):1===o.length?(i=e,e=this.element):2===o.length?(s=i,i=e,e=this.element):(e||(e=this.element),this._delegateElements||(this._delegateElements=[]),this._delegateElements.push($(e))),t(i)&&n(s)){var a={};a[i]=s,i=a}for(var h in i)if(i.hasOwnProperty(h)){var d=l(h,this),c=d.type,m=d.selector;!function(t,i){var s=function(e){n(t)?t.call(i,e):i[t](e)};m?$(e).on(c,m,s):$(e).on(c,s)}(i[h],this)}return this},undelegateEvents:function(e,t){var n=u(Array.prototype.slice.call(arguments));if(t||(t=e,e=null),0===n.length){var i=m+this.cid;if(this.element&&this.element.off(i),this._delegateElements)for(var s in this._delegateElements)this._delegateElements.hasOwnProperty(s)&&this._delegateElements[s].off(i)}else{var r=l(t,this);e?$(e).off(r.type,r.selector):this.element&&this.element.off(r.type,r.selector)}return this},setup:function(){},render:function(){this.rendered||(this._renderAndBindAttrs(),this.rendered=!0);var e=this.get("parentNode");if(e&&!i(this.element[0])){var t=this.constructor.outerBoxClass;if(t){var n=this._outerBox=$("<div></div>").addClass(t);n.append(this.element).appendTo(e)}else this.element.appendTo(e)}return this},_renderAndBindAttrs:function(){var e=this,t=e.attrs;for(var n in t)if(t.hasOwnProperty(n)){var i=f+s(n);if(this[i]){var r=this.get(n);a(r)||this[i](r,void 0,n),function(t){e.on("change:"+n,function(n,i,s){e[t](n,i,s)})}(i)}}},_onRenderId:function(e){this.element.attr("id",e)},_onRenderClassName:function(e){this.element.addClass(e)},_onRenderStyle:function(e){this.element.css(e)},_stamp:function(){var e=this.cid;(this.initElement||this.element).attr(p,e),v[e]=this},$:function(e){return this.element.find(e)},destroy:function(){this.undelegateEvents(),delete v[this.cid],this.element&&this._isTemplate&&(this.element.off(),this._outerBox?this._outerBox.remove():this.element.remove()),this.element=null,g.superclass.destroy.call(this)}});$(window).unload(function(){for(var e in v)v[e].destroy()}),g.query=function(e){var t,n=$(e).eq(0);return n&&(t=n.attr(p)),v[t]},g.autoRender=c.autoRender,g.autoRenderAll=c.autoRenderAll,g.StaticsWhiteList=["autoRender"],module.exports=g;var E=Object.prototype.toString,_=0,y=$.contains||function(e,t){return!!(16&e.compareDocumentPosition(t))},A=/^(\S+)\s*(.*)$/,R=/{{([^}]+)}}/g,w="INVALID_SELECTOR"});