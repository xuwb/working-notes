"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define(function(require,exports){var e=require("common/limit"),t=window;if(t.Promise)return Promise.prototype.Catch=function(e){return this.then(null,e)},Promise;var n=function(){function t(){var n=this;if(_classCallCheck(this,t),this.PromiseStatus="pedding",this.PromiseValue=void 0,this.Stack=[],e.isFunction(arguments.length<=0?void 0:arguments[0])){this.promiseList=[];var i=arguments.length<=0?void 0:arguments[0],r=function(t){e.each([n].concat(n.promiseList),function(e){"pedding"===e.PromiseStatus&&(e.PromiseStatus="resolved",e.PromiseValue=t,e._clean())})},o=function(t){e.each([n].concat(n.promiseList),function(e){"pedding"===e.PromiseStatus&&(e.PromiseStatus="rejected",e.PromiseValue=t,e._clean())}),setTimeout(function(){if(!n.promiseList.length)throw"(in promise) "+t},0)};try{i(r,o)}catch(s){this.PromiseStatus="rejected",this.PromiseValue=s}}else this.PromiseStatus=arguments.length<=0?void 0:arguments[0],this.PromiseValue=arguments.length<=1?void 0:arguments[1]}return _createClass(t,[{key:"then",value:function(n,i){n=e.cb(n),i=e.cb(i);var r=this;if(r.promiseList){var o=r;r=new t(r.PromiseStatus,r.PromiseValue),o.promiseList.push(r)}return r.Stack.push({suc:n,err:i}),"pedding"===r.PromiseStatus||r.cleanStatus||r._clean(),r}},{key:"Catch",value:function(e){return this.then(null,e)}},{key:"_clean",value:function(){var e=this,t=e.Stack.shift();return e.cleanStatus="init",t?setTimeout(function(){try{switch(e.PromiseStatus){case"resolved":e.PromiseValue=t.suc(e.PromiseValue);break;case"rejected":e.PromiseValue=t.err(e.PromiseValue)}e.PromiseStatus="resolved"}catch(n){e.PromiseStatus="rejected",e.PromiseValue=n,e.Stack.length||setTimeout(function(){throw"(in promise) "+n},0)}e._clean()},0):delete e.cleanStatus,e}}],[{key:"all",value:function(n){function i(e,t){s[t]=e,--r||o(s)}var r=n.length,o=void 0,s=[];return new t(function(t,r){o=t,e.each(n,function(e,t){e.PromiseStatus?e.then(function(e){i(e,t)},function(e){r(e)}):i(e,t)})})}},{key:"race",value:function(n){return new t(function(i,r){e.each(n,function(e){t.resolve(e).then(function(e){return i(e)},function(e){return r(e)})})})}},{key:"resolve",value:function(e){return new t(e&&e.then?function(t,n){e.then(t,n)}:function(t,n){t(e)})}},{key:"reject",value:function(e){return new t(function(t,n){n(e)})}}]),t}();return n});