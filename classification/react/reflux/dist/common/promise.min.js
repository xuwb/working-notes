"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define(function(e,t){var n=e("common/limit"),i=window;if(i.Promise)return Promise.prototype.Catch=function(e){return this.then(null,e)},Promise;var r=function(){function e(){var t=this;if(_classCallCheck(this,e),this.PromiseStatus="pedding",this.PromiseValue=void 0,this.Stack=[],n.isFunction(arguments.length<=0?void 0:arguments[0])){this.promiseList=[];var i=arguments.length<=0?void 0:arguments[0],r=function(e){n.each([t].concat(t.promiseList),function(t){"pedding"===t.PromiseStatus&&(t.PromiseStatus="resolved",t.PromiseValue=e,t._clean())})},o=function(e){n.each([t].concat(t.promiseList),function(t){"pedding"===t.PromiseStatus&&(t.PromiseStatus="rejected",t.PromiseValue=e,t._clean())}),setTimeout(function(){if(!t.promiseList.length)throw"(in promise) "+e},0)};try{i(r,o)}catch(s){this.PromiseStatus="rejected",this.PromiseValue=s}}else this.PromiseStatus=arguments.length<=0?void 0:arguments[0],this.PromiseValue=arguments.length<=1?void 0:arguments[1]}return _createClass(e,[{key:"then",value:function(t,i){t=n.cb(t),i=n.cb(i);var r=this;if(r.promiseList){var o=r;r=new e(r.PromiseStatus,r.PromiseValue),o.promiseList.push(r)}return r.Stack.push({suc:t,err:i}),"pedding"===r.PromiseStatus||r.cleanStatus||r._clean(),r}},{key:"Catch",value:function(e){return this.then(null,e)}},{key:"_clean",value:function(){var e=this,t=e.Stack.shift();return e.cleanStatus="init",t?setTimeout(function(){try{switch(e.PromiseStatus){case"resolved":e.PromiseValue=t.suc(e.PromiseValue);break;case"rejected":e.PromiseValue=t.err(e.PromiseValue)}e.PromiseStatus="resolved"}catch(n){e.PromiseStatus="rejected",e.PromiseValue=n,e.Stack.length||setTimeout(function(){throw"(in promise) "+n},0)}e._clean()},0):delete e.cleanStatus,e}}],[{key:"all",value:function(t){function i(e,t){s[t]=e,--r||o(s)}var r=t.length,o=void 0,s=[];return new e(function(e,r){o=e,n.each(t,function(e,t){e.PromiseStatus?e.then(function(e){i(e,t)},function(e){r(e)}):i(e,t)})})}},{key:"race",value:function(t){return new e(function(i,r){n.each(t,function(t){e.resolve(t).then(function(e){return i(e)},function(e){return r(e)})})})}},{key:"resolve",value:function(t){return new e(t&&t.then?function(e,n){t.then(e,n)}:function(e,n){e(t)})}},{key:"reject",value:function(t){return new e(function(e,n){n(t)})}}]),e}();return r});